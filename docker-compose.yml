version: "3.8"
services:
    app:
        build:
            context: .
            dockerfile: iac/containers/node/Dockerfile
            target: installer
        command: ["yarn", "start:dev"]
        ports:
            - "3000:3000"
        env_file:
            - .env.example
        environment:
            DB_HOST: postgres
            REDIS_HOST: redis
        volumes:
            - ./:/app
            - /app/node_modules
        depends_on:
            - postgres
            - redis

    postgres:
        build:
            context: .
            dockerfile: iac/containers/postgres/Dockerfile
        container_name: postgres
        restart: always
        environment:
            POSTGRES_USER: root
            POSTGRES_PASSWORD: development
            POSTGRES_DB: challenge-bravo
            PGDATA: /var/lib/postgres
        ports:
            - "5432:5432"
    redis:
        build:
            context: .
            dockerfile: iac/containers/redis/Dockerfile
        container_name: redis
        restart: always
        volumes:
            - ./redis:/data
        ports:
            - "6379:6379"
volumes:
    redis:
        driver: local


